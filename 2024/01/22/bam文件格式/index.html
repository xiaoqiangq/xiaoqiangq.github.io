

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="魏强">
  <meta name="keywords" content="">
  
    <meta name="description" content="Sam&#x2F;Bam文件格式详解 bam文件是sam文件的二进制格式。(https:&#x2F;&#x2F;samtools.github.io&#x2F;hts-specs&#x2F;SAMv1.pdf) 1. Header section 该部分全部以“@”开头，提供基本的软件版本，参考序列信息，排序信息等 @HD行：这一行中有各种不同的标识 标识“VN”用以说明格式版本 标识“SO”用以说明比对排序的情况，有unknown (">
<meta property="og:type" content="article">
<meta property="og:title" content="Sam&#x2F;Bam文件格式详解">
<meta property="og:url" content="https://xiaoqiangq.github.io/2024/01/22/bam%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/index.html">
<meta property="og:site_name" content="Qiang Wei&#39;s Lab">
<meta property="og:description" content="Sam&#x2F;Bam文件格式详解 bam文件是sam文件的二进制格式。(https:&#x2F;&#x2F;samtools.github.io&#x2F;hts-specs&#x2F;SAMv1.pdf) 1. Header section 该部分全部以“@”开头，提供基本的软件版本，参考序列信息，排序信息等 @HD行：这一行中有各种不同的标识 标识“VN”用以说明格式版本 标识“SO”用以说明比对排序的情况，有unknown (">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-01-22T08:08:14.000Z">
<meta property="article:modified_time" content="2024-05-15T10:15:39.576Z">
<meta property="article:author" content="Qiang Wei">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Sam/Bam文件格式详解 - Qiang Wei&#39;s Lab</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xiaoqiangq.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 40vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Qiang</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Sam/Bam文件格式详解"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-22 16:08" pubdate>
          2024年1月22日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          25 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Sam/Bam文件格式详解</h1>
            
            
              <div class="markdown-body">
                
                <p><strong>Sam&#x2F;Bam文件格式详解</strong></p>
<p>bam文件是sam文件的二进制格式。(<a target="_blank" rel="noopener" href="https://samtools.github.io/hts-specs/SAMv1.pdf">https://samtools.github.io/hts-specs/SAMv1.pdf</a>)</p>
<h1 id="1-Header-section"><a href="#1-Header-section" class="headerlink" title="1. Header section"></a>1. Header section</h1><ul>
<li>该部分全部以“@”开头，提供基本的软件版本，参考序列信息，排序信息等</li>
<li>@HD行：这一行中有各种不同的标识</li>
<li>标识“VN”用以说明格式版本</li>
<li>标识“SO”用以说明比对排序的情况，有unknown (default)、unsorted、queryname和coordinate,对于coordinate，排序的主键是Alignments section的第三列“RNAME”，其顺序由@SQ行的“SN”标识的顺序定义，次要排序键是Alignments section的第四列“POS”字段。对于RNAME和POS相等的比对，排列顺序则是任意的</li>
<li>@SQ行的“SN”标签是参考序列说明，它的值主要是用于Alignments section的第三列“RNAME”和第七列“MRNM”比对的记录</li>
<li>@PG行是使用的程序说明；该行“ID”为程序记录标识符，“PN”为程序名字，“CL”为命令行</li>
<li>@CO行是任意的说明信息</li>
</ul>
<p><strong>注意事项</strong></p>
<ol>
<li><strong>mapping(bwa,GATK,bismark,…)</strong></li>
<li><strong>duplication(picard,samblaster,sambamba,…)</strong></li>
<li><strong>reference genome(hg19,hg38)</strong></li>
</ol>
<h1 id="2-Alignments-section"><a href="#2-Alignments-section" class="headerlink" title="2. Alignments section"></a>2. Alignments section</h1><p>该部分包含了11列必需字段，无效或者没有的字段一般用“0”或者“*”表示</p>
<table>
<thead>
<tr>
<th align="left">Col</th>
<th align="left">Field</th>
<th align="center">Type</th>
<th align="center">Regexp&#x2F;Range</th>
<th align="left">Brief description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">QNAME</td>
<td align="center">String</td>
<td align="center">[!-?A-~]{1,254}</td>
<td align="left">Query template NAME</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">FLAG</td>
<td align="center">Int</td>
<td align="center">[0,$2^{16}$−1]</td>
<td align="left">bitwise FLAG</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">RNAME</td>
<td align="center">String</td>
<td align="center">&#96;&#96;&#96;*</td>
<td align="left">[:rname: <em>&#x3D;][:rname:]</em>&#96;&#96;&#96;</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">POS</td>
<td align="center">Int</td>
<td align="center">[0,$2^{31}$−1]</td>
<td align="left">POSition</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">MAPQ</td>
<td align="center">Int</td>
<td align="center">[0,$2^8$−1]</td>
<td align="left">MAPping Quality</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">CIGAR</td>
<td align="center">String</td>
<td align="center">\*|([0-9]+[MIDNSHPX&#x3D;])+</td>
<td align="left">CIGAR string</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">RNEXT</td>
<td align="center">String</td>
<td align="center">\*|&#x3D;|[:rname:*&#x3D;][:rname:]*</td>
<td align="left">Reference name of the mate&#x2F;next read</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">PNEXT</td>
<td align="center">Int</td>
<td align="center">[0,$2^{31}$−1]</td>
<td align="left">Position of the mate&#x2F;next read</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">TLEN</td>
<td align="center">Int</td>
<td align="center">[−$2^{31}$+1,$2^{31}$−1]</td>
<td align="left">observed Template LENgth</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">SEQ</td>
<td align="center">String</td>
<td align="center">\*|[A-Za-z&#x3D;.]+</td>
<td align="left">segment SEQuence</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">QUAL</td>
<td align="center">String</td>
<td align="center">[!-~]+ (U+2227)</td>
<td align="left">ASCII of Phred-scaled base QUALity+33</td>
</tr>
</tbody></table>
<ul>
<li>1.QNAME 序列的名字，也就是reads的名称 </li>
<li>2.<strong>FLAG</strong> 是一个标记的数字，是有需要转换成二进制才能知道代表的意思，各个数字分别代表</li>
<li>3.RNAME 参考序列的名字 </li>
<li>4.POS 在参考序列上的位置 </li>
<li>5.MAPQ mapping qulity 越高则位点越独特，比对的质量值</li>
<li>6.<strong>CIGAR</strong> 代表比对结果的CIGAR字符串，如37M1D2M1I，这段字符的意思是37个匹配，1个参考序列上的删除，2个匹配，1个参考序列上的插入。M代表的是alignment match(可以是错配)，可以理解为表示比对的具体情况 </li>
<li>7.RNEXT mate 序列所在参考序列的名称，mate一般指大的片段序列 </li>
<li>8.PNEXT mate 序列在参考序列上的位置 </li>
<li>9.<strong>TLEN</strong> 估计出的片段的长度，当mate 序列位于本序列上游时该值为负值。 </li>
<li>10.SEQ read的序列 </li>
<li>11.<strong>QUAL</strong> read序列对应的ASCII码格式的碱基质量值 </li>
<li>12.可选的区域 header section</li>
</ul>
<h2 id="2-1-第1列：Qname"><a href="#2-1-第1列：Qname" class="headerlink" title="2.1 第1列：Qname"></a>2.1 第1列：Qname</h2><ul>
<li>Read的名字</li>
</ul>
<h2 id="2-2-第2列：FLAG"><a href="#2-2-第2列：FLAG" class="headerlink" title="2.2 第2列：FLAG"></a>2.2 第2列：FLAG</h2><ul>
<li><p>每一个read的比对情况可以用十进制数字（或者十六进制数字）表示，如果比对情况 有多个，将多个比对情况所代表的十进制数字加和就是这一行的FLAG。</p>
<ul>
<li>比如，图1中r001的FLAG是99（1+2+32+64），则表示了“该read是pair read中的一个”，“pair read中每个都能够正确比对上”，“该read的mate read的反向互补可以比对上”，“该read是pari read中的read1”；</li>
<li>r001的另一个FLAG是147（1+2+16+128），则表示“该read是pair read中的一个”，“pair read中每个都能够正确比对上”，“该read是原read的反向互补”，“该read是pari read中的read2”（也就是说，该read是read2的反向互补序列）。</li>
</ul>
</li>
<li><p>值得注意的是，r001是pair read，而且都能比对上，所以r001出现了两次，如果r001的read1比对到参考序列的2个地方，r001的名字则会出现三次；如果read1比对上一次，read2没有比对上，r001仍会出现2次，不过，其中一个r001的第三列为“*”；所以pair-end测序，read1文件和read2文件同时mapping，相同reads的id最少出现2次。</p>
</li>
<li><p>以下网站可以通过输入FLAG值，直接找出该FLAG是那些FLAG的加和：Decoding SAM flags（<a target="_blank" rel="noopener" href="https://broadinstitute.github.io/picard/explain-flags.html%EF%BC%89">https://broadinstitute.github.io/picard/explain-flags.html）</a></p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Value 10</th>
<th align="left">Value 16</th>
<th align="left">Description</th>
<th align="center">99</th>
<th align="center">83</th>
<th align="center">147</th>
<th align="center">163</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">0x1</td>
<td align="left">read paired</td>
<td align="center">+</td>
<td align="center">+</td>
<td align="center">+</td>
<td align="center">+</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">0x2</td>
<td align="left">read mapped in proper pair</td>
<td align="center">+</td>
<td align="center">+</td>
<td align="center">+</td>
<td align="center">+</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">0x4</td>
<td align="left">read unmapped</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">0x8</td>
<td align="left">mate unmapped</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="left">16</td>
<td align="left">0x10</td>
<td align="left">read reverse strand</td>
<td align="center"></td>
<td align="center">+</td>
<td align="center">+</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">32</td>
<td align="left">0x20</td>
<td align="left">mate reverse strand</td>
<td align="center">+</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">+</td>
</tr>
<tr>
<td align="left">64</td>
<td align="left">0x40</td>
<td align="left">first in pair</td>
<td align="center">+</td>
<td align="center">+</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="left">128</td>
<td align="left">0x80</td>
<td align="left">second in pair</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">+</td>
<td align="center">+</td>
</tr>
<tr>
<td align="left">256</td>
<td align="left">0x100</td>
<td align="left">not primary alignment</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="left">512</td>
<td align="left">0x200</td>
<td align="left">read fails platform&#x2F;vendor quality checks</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="left">1024</td>
<td align="left">0x400</td>
<td align="left">read is PCR or optical duplicate</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="left">2048</td>
<td align="left">0x800</td>
<td align="left">supplementary alignment</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-literal">-------------------------------------------------------------</span><br><span class="hljs-literal">---</span><span class="hljs-comment">R1</span><span class="hljs-literal">---</span>&gt; <span class="hljs-comment">99</span>                  <span class="hljs-literal">--------</span><span class="hljs-comment">R2</span><span class="hljs-literal">------</span>&gt;  <span class="hljs-comment">163</span><br><br>          &lt;<span class="hljs-literal">----</span><span class="hljs-comment">R2</span><span class="hljs-literal">----</span>  <span class="hljs-comment">147</span>            &lt;<span class="hljs-literal">--------</span><span class="hljs-comment">R1</span><span class="hljs-literal">------</span>  <span class="hljs-comment">83</span><br><span class="hljs-literal">-------------------------------------------------------------</span> <span class="hljs-comment">reverse strand</span><br></code></pre></td></tr></table></figure>

<h2 id="2-3-第3列：RNAME"><a href="#2-3-第3列：RNAME" class="headerlink" title="2.3 第3列：RNAME"></a>2.3 第3列：RNAME</h2><ul>
<li>比对上的参考序列的名字，该名字出现在Header section的@SQ行的SN标识中，如果该read没有比对上，也就是说该read在参考序列上没有坐标，那么这一列则用“”表示，那么这一行的POS和CIGAR列也会是“”。</li>
</ul>
<h2 id="2-4-第4列：POS"><a href="#2-4-第4列：POS" class="headerlink" title="2.4 第4列：POS"></a>2.4 第4列：POS</h2><ul>
<li>read比对到的参考序列“RNAME”最左侧的位置坐标，也是CIGAR中第一个比对标识“M”对应的最左侧碱基在参考序列的位置，未比对上的read在参考序列中没有坐标，此列标识为“0”。</li>
</ul>
<h2 id="2-5-第5列：MAPQ"><a href="#2-5-第5列：MAPQ" class="headerlink" title="2.5 第5列：MAPQ"></a>2.5 第5列：MAPQ</h2><ul>
<li>比对的质量值，计算方法为比对错误率的-10*log10的值，一般是四舍五入的整数值，如果是255，说明该比对值无效。</li>
</ul>
<h2 id="2-6-第6列：CIGAR"><a href="#2-6-第6列：CIGAR" class="headerlink" title="2.6 第6列：CIGAR"></a>2.6 第6列：CIGAR</h2><p>CIGAR标识符表示read中每个碱基的比对情况，主要有以下标识符：</p>
<ul>
<li><p>M: alignment match (can be a sequence match or mismatch)<br>read上的碱基与参考序列“RNAME”完全匹配，碱基一一对应，包括了正确匹配与错误匹配</p>
</li>
<li><p>I: insertion to the reference<br>read上的碱基相对于参考序列“RNAME”有插入现象（如下）：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">REF:  <span class="hljs-built_in">CACGATCA</span>**GACCGATACGTCCGA <br>READ1:  <span class="hljs-built_in">CGATCAGAGACCGATA</span> <br><span class="hljs-built_in">CIGAR</span>：<span class="hljs-number">6</span>M2I8M<br></code></pre></td></tr></table></figure></li>
<li><p>D: deletion from the reference<br>read上的碱基相对于参考序列“RNAME”有删除现象（如下）：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">REF:</span> AGCTAGCATCGTGTCGCCCGTCTAGCATACGC<br><span class="hljs-symbol">READ:</span>             TCGCCCGT-TAGCAT<br>CIGAR：<span class="hljs-number">8</span>M1D6M<br></code></pre></td></tr></table></figure></li>
<li><p>N: skipped region from the reference<br>read上的碱基相对于参考序列“RNAME”存在连续没有比对上的空缺，这些空缺用N来表示，跟“D”相似但远比“D”缺失的更多，这种比对类型也叫“Spliced alignment”，常见cDNA与参考序列比对（如下）:”…”表示intron</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lasso">REF:AGCATCGTGTCGCCCGTCTAGCATACGCATGATCGACTGTCAGCTAGTCAGACTA<br>READ:     GTGTAACCC<span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>..TCAGAATA<br>CIGAR：<span class="hljs-number">9</span>M32N8M<br></code></pre></td></tr></table></figure></li>
<li><p>S: soft clipping (clipped sequences present in SEQ)</p>
</li>
<li><p>H: hard clipping (clipped sequences NOT present in SEQ)<br>read的开头或者结尾部分没有比对到参考序列”RNAME”上，但这部分未比对上的连续序列仍保留在sam文件的该read序列中，用“S”来表示；如果未保留，则用“H”表示，也即“hard cliping”（如下所示，也可同图2中r003的比对CIGAR中看出）</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gcode">REF: AGCTAGCATCGTGTCGCCCGTCTAGCATACGCAT<br>READ:          gggTCGCCCGT-TAGCATgggg<br>CIGAR：<span class="hljs-number">3</span>S<span class="hljs-number">8</span><span class="hljs-name">M1</span>D<span class="hljs-number">6</span><span class="hljs-name">M4</span>S （在sam中存储为GGGGTGTAACCGACTAGGGGG）<br>CIGAR：<span class="hljs-number">3</span>H<span class="hljs-number">8</span><span class="hljs-name">M1</span>D<span class="hljs-number">6</span><span class="hljs-name">M4</span>H （在sam中存储为GTGTAACCGACTAG）<br></code></pre></td></tr></table></figure></li>
<li><p>P: padding (silent deletion from padded reference)<br>多条read比对到参考序列的同一位置时，如果不同read单独同该参考序列比对时，参考序列的情况也不同，比如下方READ1同参考序列比对时，“GA”属于插入（6M2I8M），READ2同参考序列比对时，“A”属于插入（4M1I9M ），READ3同参考序列完全匹配（10M），没有插入，但是三条read之前却没有可比性。因此，当参考序列“比对情况包含完整”且序列唯一时，所有read同时进行比对，read3这种原本没有插入却默认插入的比对称之为Padded alignment，这种情况用“P”表示。</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">REF</span><span class="hljs-punctuation">:</span> <span class="hljs-string"> CACGATCA**GACCGATACGTCCGA</span><br><span class="hljs-attribute">READ1</span><span class="hljs-punctuation">:</span> <span class="hljs-string"> CGATCAGAGACCGATA </span><br><span class="hljs-attribute">READ2</span><span class="hljs-punctuation">:</span> <span class="hljs-string">   ATCA*AGACCGATAC </span><br><span class="hljs-attribute">READ3</span><span class="hljs-punctuation">:</span> <span class="hljs-string">  GATCA**GACCG  </span><br><span class="hljs-attribute">The padded CIGAR are different</span><span class="hljs-punctuation">: </span><br><span class="hljs-attribute">READ1</span><span class="hljs-punctuation">:</span> <span class="hljs-string">6M2I8M </span><br><span class="hljs-attribute">READ2</span><span class="hljs-punctuation">:</span> <span class="hljs-string">4M1P1I9M  </span><br><span class="hljs-attribute">READ3</span><span class="hljs-punctuation">:</span> <span class="hljs-string">5M2P5M</span><br></code></pre></td></tr></table></figure></li>
<li><p>&#x3D;：sequence match 正确匹配</p>
</li>
<li><p>X：sequence mismatch 错误匹配</p>
</li>
</ul>
<blockquote>
<p>perl CIGAR代码 为了检测每个read的甲基化情况</p>
</blockquote>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">my</span> @f=<span class="hljs-keyword">split</span>(<span class="hljs-regexp">/\s+/</span>,$line);<br><br><span class="hljs-keyword">my</span> $flag = $f[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">my</span> $chr = $f[<span class="hljs-number">2</span>];<br><span class="hljs-keyword">my</span> $pos = $f[<span class="hljs-number">3</span>];<br><span class="hljs-keyword">my</span> $cigar_2 = $f[<span class="hljs-number">5</span>];<br><br><span class="hljs-comment"># parsing CIGAR string</span><br><span class="hljs-keyword">my</span> @len = <span class="hljs-keyword">split</span> (<span class="hljs-regexp">/\D+/</span>,$cigar_2); <span class="hljs-comment"># storing the length per operation</span><br><span class="hljs-keyword">my</span> @ops = <span class="hljs-keyword">split</span> (<span class="hljs-regexp">/\d+/</span>,$cigar_2); <span class="hljs-comment"># storing the operation</span><br><span class="hljs-keyword">shift</span> @ops; <span class="hljs-comment"># remove the empty first element</span><br><span class="hljs-keyword">die</span> <span class="hljs-string">&quot;CIGAR string contained a non-matching number of lengths and operations ($cigar_2)\n&quot;</span> <span class="hljs-keyword">unless</span> (<span class="hljs-keyword">scalar</span> @len == <span class="hljs-keyword">scalar</span> @ops);<br><br><span class="hljs-comment">### determining end position of the read</span><br><span class="hljs-keyword">my</span> $readPos = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">my</span> $genomePos = $pos;<br><br><span class="hljs-keyword">foreach</span> <span class="hljs-keyword">my</span> $index(<span class="hljs-number">0</span>..$#len)&#123;<br><br>	<span class="hljs-keyword">my</span> $lengthSeg = $len[$index];<br><br>	<span class="hljs-keyword">if</span> ($ops[$index] eq <span class="hljs-string">&#x27;M&#x27;</span>)&#123;  <span class="hljs-comment"># standard matching bases</span><br><br>		$readPos += $lengthSeg;<br>		$genomePos += $lengthSeg;<br>	  <br>	&#125;<br>	<span class="hljs-keyword">elsif</span>($ops[$index] eq <span class="hljs-string">&#x27;I&#x27;</span>)&#123; <span class="hljs-comment"># insertions do not affect the end position</span><br>	  <br>		$readPos += $lengthSeg;<br><br>	&#125;<br>	<span class="hljs-keyword">elsif</span>($ops[$index] eq <span class="hljs-string">&#x27;D&#x27;</span>)&#123; <span class="hljs-comment"># deletions do affect the end position</span><br>	  $genomePos += $lengthSeg;<br><br>	&#125;<span class="hljs-keyword">elsif</span>($ops[$index] eq <span class="hljs-string">&#x27;S&#x27;</span>)&#123; <span class="hljs-comment"># deletions do affect the end position</span><br>	    $readPos += $lengthSeg;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>


<h2 id="2-7-第7列：RNEXT"><a href="#2-7-第7列：RNEXT" class="headerlink" title="2.7 第7列：RNEXT"></a>2.7 第7列：RNEXT</h2><ul>
<li><p>该read的mate read比对上的参考序列的名字，该名字出现在Header section的@SQ行的SN标识中，</p>
</li>
<li><p>如果和该read所在行的第三列“RNAME”一样，则用“&#x3D;”表示，说明这对read比对到了同一条参考序列上；</p>
</li>
<li><p>如果mate read没有比对上，第七列则用“*”表示；</p>
</li>
<li><p>如果这对read没有比对到同一条参考序列，那么这一列则是mate read所在行第三列的“RNAME”。</p>
</li>
</ul>
<h2 id="2-8-第8列：PNEXT"><a href="#2-8-第8列：PNEXT" class="headerlink" title="2.8 第8列：PNEXT"></a>2.8 第8列：PNEXT</h2><ul>
<li>该read的mate read比对到的参考序列“RNAME”<strong>最左侧</strong>的位置坐标，也是mate read CIGAR中第一个比对标识“M”对应的最左侧碱基在参考序列的位置，未比对上的read在参考序列中没有坐标，此列标识为“0”。</li>
</ul>
<h2 id="2-9-第9列：ISIZE"><a href="#2-9-第9列：ISIZE" class="headerlink" title="2.9 第9列：ISIZE"></a>2.9 第9列：ISIZE</h2><ul>
<li><p>表示pair read完全匹配到同一条参考序列时，两个read之间的长度，可简单理解为测序文库的长度。这个定义有两种情况（虚线表示未比对上的序列，即soft-clipped bases）：</p>
</li>
<li><p>第一种情况如图左所示，Read1和Read2比对到同一条参考序列，此时ISIZE即为Read2的最右侧比对坐标减去Read1最左侧比对坐标；</p>
</li>
<li><p>第二种情况如图右所示，由于至今没有明确的定义和共识，因此ISIZE可以是TLEN#1，也可以是TLEN#2，视情况而定。</p>
</li>
</ul>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck">                                            <span class="hljs-comment">|</span>&lt;<span class="hljs-literal">--</span><span class="hljs-comment">TLEN#1</span><span class="hljs-literal">----</span>&gt;<span class="hljs-comment">|</span><br><span class="hljs-literal">-------------------------------</span>   <span class="hljs-literal">-----------------------------------</span><br><span class="hljs-comment">|</span><span class="hljs-literal">---</span><span class="hljs-comment">R1</span><span class="hljs-literal">---</span>&gt; <span class="hljs-comment">99                               |</span><span class="hljs-literal">---</span><span class="hljs-comment">R1</span><span class="hljs-literal">-----------------</span>&gt; <span class="hljs-comment">99</span> <br><br>                &lt;<span class="hljs-literal">----</span><span class="hljs-comment">R2</span><span class="hljs-literal">----</span><span class="hljs-comment">| 147</span>     &lt;<span class="hljs-literal">----------</span><span class="hljs-comment">R2</span><span class="hljs-literal">---------</span><span class="hljs-comment">|  147</span><br><span class="hljs-literal">-------------------------------</span>   <span class="hljs-literal">------------------------------------</span><br><span class="hljs-comment">|</span>&lt;<span class="hljs-literal">-------</span><span class="hljs-comment">TLEN #1/#2</span><span class="hljs-literal">-------</span>&gt;<span class="hljs-comment">|         |</span>&lt;<span class="hljs-literal">-------</span><span class="hljs-comment">TLEN #2</span><span class="hljs-literal">--------------</span>&gt;<span class="hljs-comment">|</span><br></code></pre></td></tr></table></figure>

<h2 id="2-10-第10列：SEQ"><a href="#2-10-第10列：SEQ" class="headerlink" title="2.10 第10列：SEQ"></a>2.10 第10列：SEQ</h2><ul>
<li>存储的序列，没有存储，此列则用“*”标识。该序列的长度<strong>一定等于</strong>CIGAR标识中“M”，“I”，“S”，“&#x3D;”，“X”标识的碱基长度之和。</li>
</ul>
<h2 id="2-11-第11列：QUAL-Base-quality-score"><a href="#2-11-第11列：QUAL-Base-quality-score" class="headerlink" title="2.11 第11列：QUAL:Base quality score"></a>2.11 第11列：QUAL:Base quality score</h2><ul>
<li><p>序列的每个碱基对应一个碱基质量字符，每个碱基质量字符对应的ASCII码值减去33（Sanger Phred-33 质量值体系），即为该碱基的测序质量得分（Phred Quality Score）。不同Phred Quality Score代表不同的碱基测序错误率，如Phred Quality Score值为20和30分别表示碱基测序错误率为1%和0.1%。（ASCII码从0-127，为什么很多Phred评分从33开始呢？因为33是第一个肉眼可见的字符!，在此之前的都是控制符，比如空格、制表等，不方便用这些控制符来表示一个碱基的质量。）</p>
</li>
<li><p>假设一个碱基测序错误的概率是P，那么此时对应的Phred quality score（常用Q表示）</p>
<blockquote>
<p>$Q &#x3D; -10log_{10}(P)$</p>
</blockquote>
</li>
<li><p>假设100个碱基中有1个出现错误，即P&#x3D;0.01，根据上式可以计算，此时Q&#x3D;20；同理，当测序错误率为0.001时，此时Q&#x3D;30。<br>测序结果中的每一个碱基都有这么一个Phred评分。为了便于描述，人们习惯上将Phred评分对应一个ASCII码，这样每一个碱基的质量都可以用一个字符来表述了。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">P</th>
<th align="center">Q (Phred quality score)</th>
<th align="center">Sanger Phred</th>
<th align="left">ASCII</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0.01</td>
<td align="center">20</td>
<td align="center">53</td>
<td align="left"><strong>5</strong></td>
</tr>
<tr>
<td align="left">0.001</td>
<td align="center">30</td>
<td align="center">63</td>
<td align="left"><strong>?</strong></td>
</tr>
<tr>
<td align="left">0.0001</td>
<td align="center">40</td>
<td align="center">73</td>
<td align="left"><strong>I</strong></td>
</tr>
<tr>
<td align="left">0.00001</td>
<td align="center">50</td>
<td align="center">83</td>
<td align="left"><strong>S</strong></td>
</tr>
</tbody></table>
<h1 id="3-samtools-软件使用"><a href="#3-samtools-软件使用" class="headerlink" title="3. samtools 软件使用"></a>3. samtools 软件使用</h1><h2 id="3-1-sort：-sort-alignment-file"><a href="#3-1-sort：-sort-alignment-file" class="headerlink" title="3.1 sort： sort alignment file"></a>3.1 sort： sort alignment file</h2><ul>
<li>本命令对bam文件中的序列进行排序，默认下是按序列在fasta文件中的顺序（即header）和序列从左往右的位点排序。</li>
</ul>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl">samtools <span class="hljs-keyword">sort</span> [-T out.prefix][-@ threads][-m maxMem][-o out.sorted.bam][in.bam]<br>samtools <span class="hljs-keyword">sort</span> -@ <span class="hljs-number">10</span> -o abc.sorted.bam abc.bam<br>samtools <span class="hljs-keyword">sort</span> -m <span class="hljs-number">500000000</span> -o abc.sorted.bam abc.bam <span class="hljs-comment"># 500M dang abc.bam文件比较大，split的文件比较多，比如200多个。</span><br></code></pre></td></tr></table></figure>
<h2 id="3-2-merge：-merge-sorted-alignments"><a href="#3-2-merge：-merge-sorted-alignments" class="headerlink" title="3.2 merge： merge sorted alignments"></a>3.2 merge： merge sorted alignments</h2><ul>
<li><p>本命令将多个排好序的bam比对文件进行合并，产生一个排好序的bam输出文件(合并后的文件不需要再进行sort)，这个文件含有所有的输入记录，并且保留了他们原来的顺序。</p>
<blockquote>
<p>samtools merge [out.bam][in1.bam][in2.bam][in3.bam]</p>
</blockquote>
</li>
</ul>
<h2 id="3-3-index：index-alignment"><a href="#3-3-index：index-alignment" class="headerlink" title="3.3 index：index alignment"></a>3.3 index：index alignment</h2><ul>
<li><p>本命令对bam文件建立索引并产生后缀为.bai的文件，用于快速的随机处理。很多后续分析的过程需要有bai文件的存在，特别是显示序列比对情况下，比如samtool的tview命令等。#必须对bam文件进行默认情况下的排序后，才能进行index。否则会报错</p>
<blockquote>
<p>samtools index aln.sorted.bam</p>
</blockquote>
</li>
</ul>
<h2 id="3-4-view：SAMBAMCRAM-conversion"><a href="#3-4-view：SAMBAMCRAM-conversion" class="headerlink" title="3.4 view：SAM&lt;-&gt;BAM&lt;-&gt;CRAM conversion"></a>3.4 view：SAM&lt;-&gt;BAM&lt;-&gt;CRAM conversion</h2><ul>
<li>本命令将sam文件转换成bam文件；然后对bam文件进行各种操作，比如数据的排序和提取(这些操作是对bam文件进行的，不能对sam文件进行该操作)；最后将排序或提取得到的数据输出为bam或sam格式。bam文件优点：bam文件为二进制文件，占用的磁盘空间比sam文本文件小；利用bam二进制文件的运算速度快。</li>
</ul>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">samtools view -b abc.sam &gt; abc.bam<br>samtools view -b abc.sam -o abc.bam<br></code></pre></td></tr></table></figure>

<h2 id="3-5-tview"><a href="#3-5-tview" class="headerlink" title="3.5 tview"></a>3.5 tview</h2><ul>
<li>直观显示reads比对到基因组的情况，与IGV类似需要先sort和index</li>
</ul>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">samtools tview abc.sorted.bam hg19.fasta<br></code></pre></td></tr></table></figure>
<ul>
<li>press <strong>g</strong> to check the alignment start from a region in the format like chr10:10,000,000 or &#x3D;10,000,000 when viewing the same reference sequence.</li>
<li>c, C, n …</li>
</ul>
<h2 id="3-6-depth"><a href="#3-6-depth" class="headerlink" title="3.6 depth"></a>3.6 depth</h2><ul>
<li>统计每个碱基位点的测序深度;需要使用重定向定义输出文件；要使用构建过索引的bam Usage: bam2depth [-r reg] [-q baseQthres] [-Q mapQthres] [-b in.bed] […] -r：（region）加染色体号； -q：要求测序碱基质量最低值； -Q：要求比对的质量最低值<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">samtools depth abc.sorted.bam &gt;abc.depth<br></code></pre></td></tr></table></figure></li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/" class="category-chain-item">生物信息学</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Sam/Bam文件格式详解</div>
      <div>https://xiaoqiangq.github.io/2024/01/22/bam文件格式/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>魏强</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年1月22日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/01/22/VCF%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/" title="VCF文件格式详解">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">VCF文件格式详解</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/01/22/2.%E5%B8%B8%E8%A7%81%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E6%95%B4%E7%90%86/" title="常见生信软件安装">
                        <span class="hidden-mobile">常见生信软件安装</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://www.cpu.edu.cn/" target="_blank" rel="nofollow noopener"><span>CPU</span></a> <i class="iconfont icon-love"></i> <a href="https://ygl.cpu.edu.cn/gmis5/dsfc/dsfcgrxx/545CA439547A89F80D33CDEEC7CB033C" target="_blank" rel="nofollow noopener"><span>Qiang</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
